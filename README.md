# Polymarket Whale Copy Trading Bot

본 프로젝트는 Polymarket의 수익 상위 트레이더(고래)들의 거래 내역을 분석 및 추적하여, 특정 조건이 충족될 경우 자동으로 매매를 복사(Copy Trading)하는 트레이딩 자동화 시스템입니다. 잦은 업데이트와 반복적인 백테스팅을 거치며 검증된 핵심 로직들이 적용되어 있습니다.

## 아키텍처 및 핵심 로직

시스템은 고래의 질적 분석, 호가창을 이용한 체결 최적화, 그리고 불필요한 거래를 막는 필터링이라는 세 가지 기둥으로 이루어져 있습니다.

### 1. 고래 스코어링 및 동적 투자 분배 (V2)
- **고래 검증**: `whale_manager.py` 스크립트를 통해 리더보드 상위 트레이더의 과거 승률, ROI, 거래 빈도를 분석하여 유효한 고래를 선별하고 데이터베이스(`whales.json`)에 저장합니다.
- **점수 기반 배팅**: 개별 고래의 30일 퍼포먼스를 기반으로 0~100점의 스코어를 산출(`whale_scorer.py`)하고, 해당 스코어에 비례하여 봇의 베팅 금액 비율을 조절합니다. 예를 들어 50점 고래에게 10달러를 배팅한다면 당해 기준 100점 고래에게는 20달러의 비중을 둡니다.

### 2. 가상 호가창 스위핑 및 동적 슬리피지 (V3)
- **VWAP 기반 체결 모사**: 단순히 현재 시장가에 일정한 슬리피지를 더하는 방식을 지양하고, 실제 Polymarket CLOB API의 호가창(Orderbook) 데이터를 불러옵니다. 목표하는 매수 수량만큼 매도 호가를 긁었을 때(Sweeping)의 산술적 평단가(VWAP)를 계산해 진입 가능 여부를 결정합니다.
- **다이나믹 슬리피지 관리**: 고래의 베팅 규모에 따라 슬리피지 허용치를 유동적으로 적용합니다. 5,000 달러 이상의 대형 매수에는 5%의 넉넉한 슬리피지를 허용해 추세를 신속히 따라가며, 100 달러 이하 소액 베팅에는 0.5%의 타이트한 슬리피지만 허용하여 불필요한 시드 손실을 방어합니다.
- **대기열 주기 최적화**: 목표 호가에 도달하지 못해 큐(Queue)에 들어간 주문은 1분 내에 체결되지 않으면 만료 처리하여 자본 회전율 하락과 뒤늦은 포모(FOMO) 매수를 차단합니다.

### 3. 확률형 필터 엔진 및 기회비용 극대화 (V4)
- **전공 마켓 필터 (Category Tagging)**: 고래별로 가장 승률과 거래빈도가 높은 3개의 핵심 분야를 태그로 저장합니다. 봇은 고래가 본인의 주요 전문 분야가 아닌 무작위 종목에 호기심으로 베팅할 경우, 해당 신호를 무시(Skip)합니다.
- **기간 한정 필터 (Duration Edge)**: 타겟 마켓의 기한(endDate) 변수를 조회하여 만기일이 30일 이상 남은 장기 마켓에는 접근하지 않습니다. 베팅 자금이 장기간 묶이는 현상을 차단하기 위함입니다.
- **대규모 거래 풀 스캔**: 리더보드 탐색 풀(Pool)을 기존 Top 100에서 Top 500 이상 수치로 대폭 확장하였습니다. 페이지네이션을 통한 API 제약을 우회하여 충분히 검증된 많은 고래들을 확보해두어, 필터망이 좁아지더라도 하루 평균 충분한 거래 기회를 확보합니다.

---

## 봇 사용 방법

본 시스템은 고래 탐색 및 평가 로직이 메인 봇에 통합되어 있습니다. 별도의 스크립트를 수동으로 실행할 필요 없이, 메인 봇을 가동하면 백그라운드에서 자동으로 유지보수가 진행됩니다.

### 1. 환경 설정 및 API 연결
- 시스템 루트 디렉토리의 `.env` 파일에 `PAPER_TRADING`, `INITIAL_BANKROLL` 수치와 Polymarket API 자격증명 정보를 설정합니다.
- 필요한 패키지를 설치합니다: `pip install -r requirements.txt`

### 2. 메인 봇 실행 (통합 실행)
```bash
python whale_copy_bot.py
```
이 한 줄의 명령으로 아래의 모든 프로세스가 자동화됩니다:
- **실시간 감시**: 고래들의 트랜잭션을 초 단위로 추적하여 조건 부합 시 즉각 카피 트레이딩을 수행합니다.
- **자동 고래 탐색 (Maintenance)**: 백그라운드 스레드에서 24시간마다 리더보드 Top 500을 스캔하여 새로운 고래를 발굴하고 성적이 저조한 고래를 명단에서 제외합니다.
- **자동 스코어링 (Maintenance)**: 1시간마다 고래들의 최신 승률, ROI, 전공 카테고리를 다시 계산하여 실시간으로 필터링 전략에 반영합니다.

### 3. 모니터링 (선택 사항)
- `python dashboard.py`: 실시간으로 현재 보유 포지션과 누적 수익률을 대시보드 형태로 확인할 수 있습니다.
- `trade_history.jsonl`: 체결된 모든 매매의 상세 로그가 기록됩니다.
- `status_WhaleCopy.json`: 봇의 현재 상태와 잔고 정보가 저장됩니다.