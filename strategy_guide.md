# POLYMARKET HATEBOT v4.0 (The Scalper & Market Maker) 전략 가이드

## 1. 핵심 철학: "시간 비례 점진적 우상향 (Micro-Scalping & Edge-Making)"
> **"방향을 맞추는 도박을 버려라. 시장의 비효율성(스프레드와 수급 코너링)을 긁어모아라."**

거래 횟수가 많지만 승률이 20~30% 대로 비참하게 무너졌던 이전 모델들(기대값 단순 의존형)은 "수수료와 슬리피지"라는 벽을 넘지 못했습니다.
v4.0의 핵심은 거시적인 가격 방향성을 예측하는 것이 아닌, **1) 호가창의 빈 공간(Spread)을 활용해 유동성을 공급하여 확정 차익을 얻거나**, **2) 압도적인 수급 쏠림(Orderbook Imbalance)이 발생할 때 찰나의 순간에 편승하는 통계적 차익거래**에 전념합니다.

---

## 2. 사용되는 시그널 (Input Data)

1. **`SPREAD_RATIO` (스프레드 비율)**: `(Best Ask - Best Bid) / Mid Price`
   - 시장의 양방향 틈새 넓이를 측정합니다.
2. **`ORDER_IMBALANCE` (호가 불균형)**: `Bids Volume / Asks Volume`
   - 폴리마켓 자체 서버 내의 스마트 머니 매수/매도 대기 물량 비율입니다.
3. **`SPOT_VELOCITY_BPS` (바이낸스 틱 가속도)**: 
   - 10초 이내에 시장 기초자산 가격이 얼마나 급변했는지(BPS) 속도를 잽니다.
4. **`FAIR_PROB` (블랙숄즈 기반 이론적 공정 확률)**:
   - 방향을 결정하기 위함이 아니라, 지정가를 깔 때 "가면 안 되는 선"을 방어하기 위한 안전망으로 씁니다.

---

## 3. 진입(Entry) 및 청산(Exit) 로직 (Pseudo-code)

### Option A: Pure Market Maker (스프레드 포획자)
이 전략은 방향성에 돈을 걸지 않습니다. 스프레드가 비정상적으로 넓은(예: 3% 이상) 마켓에서 양방향, 혹은 이론가격 대비 절대적으로 유리한 한쪽 방향에 **지정가(Limit Order)**로 대기를 타서 '수동적 체결'을 유도합니다.

```python
# [Entry Rule]
if SPREAD_RATIO > 0.03: # 스프레드가 3% 이상 넓을 때
    if FAIR_PROB > 0.4 and FAIR_PROB < 0.6: # 결과 예측이 어려운 혼전 양상일 때만
        # 시장가로 긁는게 아니라, 중간값(또는 유리한 방향)에 지정가를 깐다
        optimal_bid = FAIR_PROB - 0.015  # 공정가보다 1.5% 싸게 매수 대기
        place_limit_order(side='YES', price=optimal_bid)
```

### Option C: Imbalance Scalper (통계적 차익거래)
폴리마켓 내의 특정 세력이 호가창을 비정상적으로 기울일 때(예: 매도벽 붕괴, 매수 물량 쏠림), 스팟 가속도와 결합하여 아주 짧은 구간 찰나를 먹습니다.

```python
# [Entry Rule]
if ORDER_IMBALANCE > 5.0: # 매수 물량이 매도 물량의 5배 이상 (압도적 매수세)
    if SPOT_VELOCITY_BPS > 1.5: # 바이낸스 현물 가격도 상승 가속도를 내고 있다면
        if FAIR_PROB > 0.3: # 가망없는 쓰레기 확률만 아니면
            execute_market_order(side='YES') # 시장가로 즉시 편승
```

---

## 4. 만기 홀딩(Hold-to-Maturity) vs 조기 청산(Early Exit)

**결론: 기본적으로 "만기 홀딩(Hold-to-Maturity)"을 유지하되, 진입 타임프레임을 극단적으로 줄입니다.**

*   **현재 폴리마켓의 구조적 한계:** 폴리마켓은 오더북 두께가 얇아 조기 청산(Take Profit / Stop Loss)을 위해 반대 매매를 시장가로 던지면 **슬리피지 비용으로 인해 이익이 모두 소거**됩니다.
*   **해결책:** 만기 홀딩의 리스크(오랜 시간 돈이 묶여 시장 역전에 당할 확률)를 줄이기 위해, **만기가 5분~15분 밖에 안 남은 초단기 마켓에만 진입**합니다. 진입 후 고작 5분만 지나면 결과가 확정되므로 현금 회전율이 극대화되고 역전 리스크가 통제됩니다.

---

## 5. 리스크 및 자금 관리 (Risk & Bankroll Management)

1. **Fractional Kelly Criterion (보수적 분수 켈리)**:
   - 엣지와 확률을 기반으로 켈리 공식을 적용하되, 산출된 비중의 **10~20% (Kelly Fraction = 0.1~0.2)** 만을 베팅합니다. MDD를 최소화하기 위함입니다.
2. **건당 최대 베팅 금액 (Max Position Limit)**:
   - 아무리 엣지가 높아도 총 자본금(Bankroll)의 **3% 또는 최대 $30**를 초과하여 단일 마켓에 진입하지 않습니다.
3. **상관관계 리스크 제어**:
   - BTC/USDT 관련 동일 마켓에 2개 이상의 포지션 진입을 물리적으로 차단합니다(Anti-hedging & Over-exposure Control).

---

## 6. 장애 대응 (Fail-Safe) 시나리오

- **상황 1: Flash Crash (바이낸스 가격 순간 폭락/폭등)**
  - **대응:** `SPOT_VELOCITY_BPS`가 비정상적인 수치(예: 초당 10 BPS 이상)를 기록하면 엔진 코드 레벨에서 즉각 모든 신규 지정가 및 시장가 진입을 60초간 일시 정지(Circuit Breaker)합니다.
- **상황 2: API 연결 끊김 / WebSocket 지연**
  - **대응:** 바이낸스 또는 폴리마켓 API의 응답 지연(Timeout > 2000ms) 감지 시, 로직을 중단하고 캐시된 썩은 데이터를 기반으로 한 진입을 철저히 막습니다. 

---

## 7. 한계점(Limitations) 및 백테스트 체크리스트

### ⚠️ 현실에서 실패할 수 있는 3가지 치명적 약점
1. **유령 호가(Phantom Liquidity)와 조작**: API상에 찍힌 `ORDER_IMBALANCE`의 거대한 매수벽이, 봇이 진입하자마자 취소(Spoofing)되어 버리는 세력의 낚시일 위험이 큽니다.
2. **실제 체결 수수료 및 슬리피지**: `Spread_Ratio`를 아무리 잘 계산해도 시장가로 진입(Taker) 시 수수료와 슬리피지가 발생하여 실제 엣지는 마이너스가 될 수 있습니다.
3. **Maker Order(지정가)의 미체결 리스크**: Option A(마켓메이킹)에서 지정가를 깔아두었지만, 가격이 내 방향으로 올 때는 안 사지고 반대 방향으로 터질 때만 체결되는 역선택(Adverse Selection)에 당할 수 있습니다.

### 🧪 백테스트 단계 필수 수집/확인 데이터 포인트
- **Taker/Maker 비율 분석**: 우리가 체결된 주문 중 시장가 체결 비율과 지정가 체결 비율이 얼마나 되는가?
- **진입 직전 vs 직후 슬리피지 추적**: 로직이 결정을 내린 시점의 `Best Ask(가상)`와 거래소에서 `실제 체결된 가격(Real)` 간의 갭(BPS 차이)이 정확히 몇 %인가?
- **Imbalance 유지 시간**: 오더북 불균형이 발생(Imbalance > 5.0)한 후, 그 호가벽이 평균 몆 초 동안 유지되는가? (Spoofing 여부 판단용)
